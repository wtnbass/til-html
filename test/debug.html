<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Debug</title>
</head>

<body>
  <div id="root"></div>
  <script type="module">
    import { html, render, renderToString } from "../dist/til-html.mjs";
    let state = {
      num: 999,
      bool: false,
      name: "World",
      mouseover: () => console.log("init"),
      arr: ["a", "b", "c"],
      users: [
        { id: 1, name: "John" },
        { id: 10, name: "Mary" },
        { id: 20, name: "Aria" },
      ]
    };

    const app = () => html`
      <!doctype html>
      <!-- comment -->
      <div id="1" name="greet" data-row=1 num=${state.num} ?boo=${state.bool}>
        Hello
      </div>
      <div @mouseover=${state.mouseover}>
        <span>${state.name}</span>
      </div>
      <small>
        <div />
        <b>break
        <input type="checkbox" ref=${node => (window.$checkbox = node)} />
        <p>tag</p>
      </small>
      <div>
        ${html`<h4>template ${state.name}</h4>`}
      </div>
      <div>
        <h5>${state.arr}</h5>
        <ul>
          ${state.users.map(u => html`
            <li key=${u.id}>${u.name}</li>
          `)}
        </ul>
      </div>
    `;
    const rootElement = document.getElementById("root");
    const update = () => {
      const result = app();
      render(result, rootElement);
      console.log(renderToString(result));
    };
    const once = fn =>
      new Promise(resolve => {
        const handler = () => {
          document.body.removeEventListener("click", handler);
          fn();
          update();
          resolve();
        };
        document.body.addEventListener("click", handler);
      });
    async function main() {
      update();
      await once(() => {
        state.num = 1;
      });
      await once(() => {
        state.bool = true;
      });
      await once(() => {
        state.name = "Keisuke";
      });
      await once(() => {
        state.mouseover = () => console.log("change");
      });
      await once(() => {
        state.arr = ["b", "c"]
        state.users = [
          { id: 1, name: "John" },
          { id: 20, name: "Aria" },
        ]

      })
    }
    main();
  </script>
</body>

</html>